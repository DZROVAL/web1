var DialogSettings={LOCKBACKGROUND_COLOR:"#000",OPACITY:0.4,CONTENTBACKGROUND_COLOR:"white",PANLID:"ympop",PENDING:10,BODY_ZINDEX:1001,BG_ZINDEX:2001,PANEL_ZINDEX:3001,BTNCLOSE_ZINDEX:5001,PANELBORDER_COLOR:"#fff",PANELBORDER_WIDTH:7,PANELBORDER_OPACITY:0.7,CLOSEID:"btnclose",LOCKPANEL_ID:"lock",BORDERPANEL_ID:"popcontainer"};var Dialog=function dialog(a){this._width=a.width;this._height=a.height;this._content=a.content;this._onClose=a.onClose;this._isFixed=a.fixed;this._isIE6=function(){var b=$.browser.msie&&($.browser.version=="6.0")&&!$.support.style;if(b){return true}return false};this._isIE7=function(){var b=$.browser.msie&&($.browser.version=="7.0")&&!$.support.style;if(b){return true}return false};this._isIE8=function(){var b=$.browser.msie&&($.browser.version=="8.0")&&!$.support.style;if(b){return true}return false};this._topPX=function(){if(!this._isIE6()){var d=$(window).height(),c=(d-this._height)/3,b=$(document).scrollTop();if(this._isFixed==undefined||this._isFixed=="0"){return c}return c+b}else{var d=$(window).height(),c=(d-this._height)/3,b=$(document).scrollTop();return c+b}};this._leftPX=function(){var b=$(window).width();return(b-this._width)/2};this._HTMLPosition=function(){if(this._isIE6()){return"absolute;"}else{if(this._isFixed==undefined||this._isFixed=="0"){return"fixed !important;"}else{$("body").css("position","relative");return"absolute !important;"}}};this._clear=function(){Dialog._close();if(this._onClose!=undefined){this._onClose()}}};Dialog._close=function(){if(typeof($("#"+DialogSettings.LOCKPANEL_ID))!="undefined"){$("#"+DialogSettings.LOCKPANEL_ID).remove()}if(typeof($("#"+DialogSettings.PANLID))!="undefined"){$("#"+DialogSettings.PANLID).remove()}if(typeof($("#"+DialogSettings.BORDERPANEL_ID))!="undefined"){$("#"+DialogSettings.BORDERPANEL_ID).remove()}WATERFALL_BREAK=false};Dialog.prototype._close=function(){WATERFALL_BREAK=false;this._clear()};Dialog.prototype._closeForWait=function(b,a){if(a!=undefined){setTimeout(function(){a();WATERFALL_BREAK=false},b)}else{setTimeout(function(){Dialog._close();WATERFALL_BREAK=false},b)}};Dialog.prototype._show=function(){this._clear();var b=$(this._createHTML());var d=this;b.find("#"+DialogSettings.CLOSEID).click(function(){d._clear()});for(var c=0;c<b.length;c++){var a=$(b[c]);if(a.attr("id")==DialogSettings.LOCKPANEL_ID){a.click(function(){d._clear()})}}$("body").append(b);WATERFALL_BREAK=true};Dialog.prototype._createHTML=function(){var c=new Array();var a=$(document).height();var b=$(document).width();c.push('<div id="'+DialogSettings.LOCKPANEL_ID+'" style="filter:alpha(opacity=40);');c.push("width:");c.push(b+"px;");c.push("height:");c.push(a+"px;");c.push("z-index:");c.push(DialogSettings.BODY_ZINDEX+";");if(!this._isIE6()&&!this._isIE8()&&!this._isIE7()){c.push("opacity:");c.push(DialogSettings.OPACITY+";");c.push("background-color:");c.push(DialogSettings.LOCKBACKGROUND_COLOR+";")}c.push("position:absolute;left:0px;top:0px;");c.push('">&nbsp;');c.push("</div>");c.push('<div id="'+DialogSettings.BORDERPANEL_ID+'" style="border:8px solid #333; min-height:250px;background-color:#fff;');c.push("position:");c.push(this._HTMLPosition()+";");c.push("z-index:");c.push(DialogSettings.BG_ZINDEX+";");c.push("width:");c.push(this._width+"px;");c.push("background-color:");c.push(DialogSettings.PANELBORDER_COLOR+";");c.push("left:");c.push((this._leftPX()-DialogSettings.PANELBORDER_WIDTH)+"px;");c.push("top:");var d=(this._topPX()-DialogSettings.PANELBORDER_WIDTH);if(d<=0){d=10}c.push(d+"px;");c.push('">');c.push("</div>");return c.join("")};
var REQUEST_URLS_CONFIG;var ENABLE_WATER=true;var tooopen=function(a){REQUEST_URLS_CONFIG=a};tooopen.init=function(a){REQUEST_URLS_CONFIG=a};tooopen._removeCollect=function(a,b){tooopen._checkLogined({callback:function(){tooopen._request(REQUEST_URLS_CONFIG.ajaxDeleteFavorites,true,"jsonp","GET",{downid:a},function(c){if(c!=undefined){if(c.State==1){b.hide(300)}}})}})};tooopen._checkLogined=function(a){if(a.startRequest!=undefined){a.startRequest()}tooopen._request(REQUEST_URLS_CONFIG.ajaxCheckLogined,true,"jsonp","GET",undefined,function(b){if(b!=undefined){if(b.State==0){tooopen._showLoginWindow(a.callback)}else{a.callback()}}})};tooopen._requestUserState=function(b){var a=b||$("#sm10");tooopen._request(REQUEST_URLS_CONFIG.requestUserUrl,true,"jsonp","GET",undefined,function(c){if(c!=undefined){a.html(c.Value);if(c.State==0){a.find("#btn-login").click(function(){tooopen._showLoginWindow()});a.find("#btn-register").click(function(){tooopen._showRegisterWindow(function(){tooopen._requestUserState()})})}else{tooopen._dropDownBind(a.find(".nav-user"),a.find(".top-menuup"),a.find("#userlogin-ok"))}}})};tooopen._showLoginWindow=function(b){var a=new Dialog({width:720,height:310,onClose:function(){tooopen._startWater()}});a._show();tooopen._stopWater();tooopen._request(REQUEST_URLS_CONFIG.requestWindowLogin,true,"jsonp","GET",undefined,function(g){if(g!=undefined){$("#popcontainer").html(g.html);$("#popcontainer").find(".dia-close").click(function(){a._close()});$("#popcontainer").find("#btnRegisterNow").click(function(){tooopen._showRegisterWindow(function(){tooopen._showLoginWindow(b)})});var f=$("#popcontainer").find(".inputicon-name");var e=$("#popcontainer").find(".inputicon-pass");var d=$("#popcontainer").find("#txtIdentImgwdlg");var c=$("#popcontainer").find(".dia-login-but");_textBoxFoucs(f,"会员邮箱/帐号","dia-login-input-h");e.keydown(function(){if(event.keyCode==13){c.click()}});d.keydown(function(){if(event.keyCode==13){c.click()}});c.click(function(){if($("#popcontainer").find(".dia-login-but").attr("data-logined")=="1"){return}var i=new Array();i.push({e:f,message:"请填写您的会员邮箱/帐号 !",func:function(){return $.trim(f.val()).length>0&&$.trim(f.val())!="会员邮箱/帐号"}});i.push({e:e,message:"请输入您的密码 !",func:function(){return $.trim(e.val()).length>0&&$.trim(e.val())!="密码"}});i.push({e:d,message:"请输入验证码 !",func:function(){return $.trim(d.val()).length>0}});var h=_checkFormByArray(i,undefined,undefined);if(h){$("#popcontainer").find(".dia-login-but").attr("data-logined","1");tooopen._request(REQUEST_URLS_CONFIG.ajaxLoginUrl,false,"jsonp","GET",{username:f.val(),password:e.val(),IdentImg:d.val()},function(j){$("#popcontainer").find(".dia-login-but").attr("data-logined","0");if(j!=undefined){c.attr("data-logined","0");if(j.State==2){a._close();if(b!=undefined){b()}tooopen._requestUserState();return}else{if(j.State==1){$("#messgeBox").text("对不起，您的帐号已经被锁定，请联系客服。")}else{if(j.State==3){$("#messgeBox").text("验证码输入错误!")}else{$("#messgeBox").text("对不起，您的用户名密码错误。请重试。")}}}d.val("");tooopen._resetCaptcha($("#imgIdentwdlg"),"login")}})}})}})};tooopen._showRegisterWindow=function(b){var a=new Dialog({width:720,height:381,onClose:function(){tooopen._startWater()}});a._show();tooopen._stopWater();tooopen._request(REQUEST_URLS_CONFIG.requestWindowRegister,true,"jsonp","GET",undefined,function(c){if(c!=undefined){$("#popcontainer").html(c.html);$("#popcontainer").find(".dia-close").click(function(){a._close()});$("#popcontainer").find("#btnSubmitReg").click(function(){var e=$("#popcontainer").find("#txtAccount");var i=$("#popcontainer").find("#txtRealName");var g=$("#popcontainer").find("#txtPassword");var h=$("#popcontainer").find("#txtPasswordConfirm");var f=$("#popcontainer").find("#txtimgIdent");var d=$("#popcontainer").find("#cbkAgreement");if($("#popcontainer").find("#btnSubmitReg").attr("data-reged")=="1"){return}var k=new RegExp("([a-zA-Z.0-9_-])+@([a-zA-Z0-9_-])+((.[a-zA-Z0-9_-]{2,3}){1,2})");var l=new Array();l.push({e:e,message:"请输入邮箱 !",func:function(){return $.trim(e.val()).length>0}});l.push({e:e,message:"邮箱格式不正确 !",func:function(){return k.test($.trim(e.val()))}});l.push({e:i,message:"请输入昵称,2~7个字符 !",func:function(){return $.trim(i.val()).length>=2&&$.trim(i.val()).length<=7}});l.push({e:g,message:"请输入密码,6~12个字符 !",func:function(){return $.trim(g.val()).length>=6&&$.trim(g.val()).length<=20}});l.push({e:h,message:"密码两次输入不一致 !",func:function(){return $.trim(h.val())==$.trim(g.val())}});l.push({e:f,message:"请输入验证码 !",func:function(){return $.trim(f.val()).length>0}});l.push({e:d,message:"请阅读《素材公社网（tooopen.com）会员素材上传与下载服务协议》!",func:function(){return d.attr("checked")}});var j=_checkFormByArray(l,undefined,undefined);if(j){$("#popcontainer").find("#btnSubmitReg").attr("data-reged","1");tooopen._request(REQUEST_URLS_CONFIG.ajaxPostRegisterUrl,true,"jsonp","GET",{account:e.val(),realName:i.val(),password:g.val(),confrimPassword:h.val(),IdentImgReg:f.val()},function(m){$("#popcontainer").find("#btnSubmitReg").attr("data-reged","0");if(m!=undefined){switch(m.State){case 0:$("#messgeBox").text("注册参数有误，请重试 !");break;case 1:$("#messgeBox").text("邮箱已经被注册，请重试 !");break;case 2:$("#messgeBox").text("注册失败，程序出错，请联系客服或重试 !");break;case 3:$("#registerForm").hide();$("#registerOk").show();$("#popcontainer").height(340);$("#btnkown").click(function(){a._close()});$(".reg-info h4").text("欢迎您，"+i.val());$(".reg-info b").text(e.val());$("#cbxsub").change(function(){var n=$(this).attr("checked");tooopen._request(REQUEST_URLS_CONFIG.mainUrl+"/common/ajaxsubscribe",true,"jsonp","GET",{cbx:n},function(){})});tooopen._requestUserState();return;case 4:$("#messgeBox").text("验证码输入错误 ! ");break;case 5:$("#messgeBox").text("密码两次输入不一致 !");break}f.val("");tooopen._resetCaptcha($("#imgIdentReg"),"reg")}})}});$("#btnSubmitCancel").click(function(){a._close()})}})};tooopen._showCollectWindow=function(a){if(a==undefined){return}var b=a();if(b==undefined||isNaN(b)){return}tooopen._request(REQUEST_URLS_CONFIG.ajaxPostCollectUrl,true,"jsonp","GET",{id:b},function(c){if(c!=undefined){if(c.State==0){tooopen._showLoginWindow(function(){tooopen._request(REQUEST_URLS_CONFIG.ajaxPostCollectUrl,true,"jsonp","GET",{id:b},function(d){if(d!=undefined){_showSlideBox(d.Value)}})})}else{_showSlideBox(c.Value)}}})};tooopen._showSubscribeWindow=function(c,a){if(c==undefined){return}var b=$(c).attr("data-id");if(b==undefined||isNaN(b)){return}tooopen._request(REQUEST_URLS_CONFIG.ajaxPostSubscribe,true,"jsonp","GET",{id:b},function(d){if(d!=undefined){if(d.State==0){tooopen._showLoginWindow(function(){tooopen._request(REQUEST_URLS_CONFIG.ajaxPostSubscribe,true,"jsonp","GET",{id:b},function(e){if(a!=undefined){a()}else{_changeSubscribeState(c,e);_changeSubscribeCount(c,1)}})})}else{if(a!=undefined){a()}else{_changeSubscribeState(c,d);_changeSubscribeCount(c,1)}}}})};tooopen._cancelSubscribe=function(c,a){if(c==undefined){return}var b=$(c).attr("data-id");if(b==undefined||isNaN(b)){return}tooopen._request(REQUEST_URLS_CONFIG.ajaxPostCancelSubscribe,true,"jsonp","GET",{id:b},function(d){if(d!=undefined){if(d.State==1){if(a==undefined){c.removeClass("but-din-yes").addClass("but-din");$(".but-din-yes").unbind().click(function(){tooopen._cancelSubscribe($(this))});$(".but-din").unbind().click(function(){tooopen._showSubscribeWindow($(this))});_changeSubscribeCount(c,-1)}else{a()}}}})};tooopen._showAddTopicWindow=function(a){if(a==undefined){return}var b=a();if(b==undefined||isNaN(b)){return}tooopen._request(REQUEST_URLS_CONFIG.requestWindowAddTopic,true,"jsonp","GET",undefined,function(c){if(c!=undefined){if(c.State==0){tooopen._showLoginWindow(function(){tooopen._request(REQUEST_URLS_CONFIG.requestWindowAddTopic,true,"jsonp","GET",undefined,function(d){if(d!=undefined){_bindAddTopicElements(d.Value,b)}})})}_bindAddTopicElements(c.Value,b)}})};tooopen._showFeedBackWindow=function(a){if(a==undefined){return}var b=a();if(b==undefined||isNaN(b)){return}tooopen._request(REQUEST_URLS_CONFIG.requestWindowPostFeedBack,true,"jsonp","GET",{id:b},function(c){if(c!=undefined){if(c.State==0){tooopen._showLoginWindow(function(){tooopen._request(REQUEST_URLS_CONFIG.requestWindowPostFeedBack,true,"jsonp","GET",{id:b},function(d){if(d!=undefined){_bindPoistFeedBack(d.Value)}})})}else{_bindPoistFeedBack(c.Value)}}})};tooopen._closeLoginWindow=function(){};tooopen._stopWater=function(){ENABLE_WATER=false};tooopen._startWater=function(){ENABLE_WATER=true};tooopen._request=function(f,a,c,e,b,d){$.ajax({url:f+"?r="+new Date().getTime(),async:a,data:b,dataType:c,type:e,success:function(g){d(g)}})};tooopen._dropDownBind=function(a,d,c,b){c.mouseover(function(){d.show();a.addClass(b||"nav-user-sel")}).mouseout(function(){d.hide();a.removeClass(b||"nav-user-sel")})};tooopen._showAttentionWindow=function(c,a){if(c==undefined){return}var b=$(c).attr("data-id");if(b==undefined){return}tooopen._request(REQUEST_URLS_CONFIG.ajaxPostAttention,true,"jsonp","GET",{targetUserId:b},function(d){if(d!=undefined){if(d.State==0){tooopen._showLoginWindow(function(){tooopen._request(REQUEST_URLS_CONFIG.ajaxPostAttention,true,"jsonp","GET",{targetUserId:b},function(e){if(e!=undefined){_showSlideBox(e.Value);a()}})})}else{_showSlideBox(d.Value);a()}}})};tooopen._showPostMessageWindow=function(b){if(b==undefined){return}var a=$(b).attr("data-id");if(a==undefined){return}tooopen._request(REQUEST_URLS_CONFIG.requestWindowPostMessage,true,"jsonp","GET",{perid:a},function(c){if(c!=undefined){if(c.State==0){tooopen._showLoginWindow(function(){tooopen._request(REQUEST_URLS_CONFIG.requestWindowPostMessage,true,"jsonp","GET",{perid:a},function(d){if(d!=undefined){_showSlideBox(d.Value);_binPostMessage(a)}})})}else{_showSlideBox(c.Value);_binPostMessage(a)}}})};tooopen._drawImage=function(d,c,b){var a=new Image();a.src=d.attr("src");a.onload=function(){var e=a.height;var f=a.width;if(a.width>0&&a.height>0){if(a.width/a.height>=c/b){if(a.width>c){f=c;e=(a.height*c)/a.width}}else{if(a.height>b){e=b;f=(a.width*b)/a.height}}}d.height(e);d.width(f);d.attr("src",d.attr("data-src"))}};tooopen._drawImageFull=function(c,b){var a=new Image();a.src=c.attr("src");a.onload=function(){var d=a.height;var e=a.width;if(d<e){d=b;e=e/(a.height/b)}else{e=b;d=d/(a.width/b)}c.height(d);c.width(e);c.attr("src",c.attr("data-src"))}};tooopen._drawImageAuto=function(c,d,a){var b=new Image();b.src=c.attr("src");b.onload=function(){var e=b.height;var f=b.width;var j=f;var g=e;var i=0;var h=0;if(f<d&&e<a){h=(d-f)/2;i=(a-e)/2}if(f<=d&&e>=a){h=(d-f)/2;i=(e-a)/2*-1}if(e<=a&&f>=d){i=(a-e)/2;h=(f-d)/2*-1}if(e>a&&f>d){if(e<f){g=a;j=(f*a)/e;h=(j-d)/2*-1}else{j=d;g=(e*d)/f;i=(g-a)/2*-1}}c.css("width",j+"px");c.css("height",g+"px");c.css("top",i+"px");c.css("left",h+"px")}};var _textBoxFoucs=function(b,c,a){b.focus(function(){if($.trim(b.val())==c){b.val("").addClass(a)}}).blur(function(){if($.trim(b.val()).length<=0){b.val(c).removeClass(a)}})};var _showSlideBox=function(b){var a=new Dialog({width:720,height:277,onClose:function(){tooopen._startWater()}});a._show();tooopen._stopWater();$("#popcontainer").html(b);$("#popcontainer").find(".dia-close").click(function(){a._close()})};var _checkFormByArray=function(k,d,h){for(var c=0;c<k.length;c++){var g=k[c];var a=g.e;var f=g.message;var b=g.func;var j=b();if(!j){if(h!=undefined){h(g,f,b,j)}else{var d=d||$("#messgeBox");d.text(f).show()}if(a!=undefined){a.focus()}return false}}return true};var _onCollectItemClick=function(b){var a=$(b);tooopen._showCollectWindow(function(){return a.attr("data-id")})};var _onAddTopic=function(b){var a=$(b);tooopen._showAddTopicWindow(function(){return a.attr("data-id")})};var _binPostMessage=function(a){$("#txtMessage").focus();$("#btnSubmitMessage").click(function(){var b=$("#txtMessage").val();if($.trim(b).length<=0){$("#messageBox").text("请输入消息内容 !");return}if(b.length>200){$("#messageBox").text("输入长度受限, 请不要多于200字符 !");return}tooopen._request(REQUEST_URLS_CONFIG.ajaxPostMessage,true,"jsonp","GET",{userid:a,message:b},function(c){if(c!=undefined){if(c.State!=2){Dialog._close();tooopen._startWater()}else{_showSlideBox(c.Value)}}})})};var _bindAddTopicElements=function(html,id){if(html!=null&&html!=undefined){var _dialog=new Dialog({width:720,height:320,onClose:function(){tooopen._startWater()}});_dialog._show();tooopen._stopWater();var popcontainer=$("#popcontainer");popcontainer.html(html);popcontainer.find(".dia-close").click(function(){_dialog._close()});popcontainer.find("#btnAddTopic").click(function(){var topicid=$("#selTopics").val();if(topicid<=0){$("#messageBox").text("请选择专辑 !");return}tooopen._request(REQUEST_URLS_CONFIG.ajaxPostAddTopic,true,"jsonp","GET",{downId:id,topicId:topicid},function(json){if(json!=undefined){switch(json.State){case 0:$("#messageBox").text("请登录后再操作 !");break;case 1:$("#messageBox").text("检测到非法参数 !");break;case 2:case 3:popcontainer.empty().html(json.Value).height(290);popcontainer.find(".dia-close").click(function(){_dialog._close()});_dialog._closeForWait(1200,undefined);break}}})});popcontainer.find("#selParent").change(function(){var val=$(this).val();tooopen._request(REQUEST_URLS_CONFIG.requestCategoryChildren,true,"jsonp","GET",{id:val},function(json){if(json!=undefined){var children=eval(json.Value);var options=new Array();options.push("<option value='0'>选择二级分类</option>");$.each(children,function(idx,val){options.push("<option value='"+val.id+"'>"+val.title+"</option>")});var optionsHtml=options.join("");$("#selChild").empty().append(optionsHtml)}})});popcontainer.find("#btnAddNewTopic").click(function(){var btn=$(this);if(btn.attr("data-submited")=="1"){return}var validates=new Array();var txtNewTopic=$("#txtNewTopicTitle");var selParent=$("#selParent");var selChild=$("#selChild");var txtAddTopicCaptch=$("#txtAddTopicCaptch");validates.push({e:txtNewTopic,message:"请输入专辑标题 !",func:function(){return $.trim(txtNewTopic.val()).length>0&&$.trim(txtNewTopic.val())!="专辑标题(30字符以内)"}});validates.push({message:"请选择专辑分类 !",func:function(){return selParent.val()>0&&selChild.val()>0}});validates.push({e:txtAddTopicCaptch,message:"请输入验证码 !",func:function(){return $.trim(txtAddTopicCaptch.val()).length>0}});var checked=_checkFormByArray(validates,$("#messageBoxAddTopic"));if(checked){btn.attr("data-submited","1");tooopen._request(REQUEST_URLS_CONFIG.ajaxPostNewTopic,true,"jsonp","GET",{title:txtNewTopic.val(),parentId:selParent.val(),childId:selChild.val(),captch:txtAddTopicCaptch.val()},function(json){if(json!=undefined){switch(json.State){case 0:$("#messageBoxAddTopic").text("请先登录 !");break;case 1:$("#messageBoxAddTopic").text("提交参数错误 !");break;case 2:$("#messageBoxAddTopic").text("输入参数不合法 !");break;case 3:$("#messageBoxAddTopic").text("验证码输入错误 !");txtAddTopicCaptch.val("");tooopen._resetCaptcha($("#imgTopicCaptch"),"topicCaptch");break;case 4:popcontainer.find(".dia-addtopic").show();popcontainer.find(".dia-newtopic").hide();popcontainer.height(320);var topics=eval(json.Value);var topicsArray=new Array();topicsArray.push("<option value='0'>请选择您的专辑</option>");$.each(topics,function(idx,val){if(val.selected){topicsArray.push("<option value='"+val.id+"' selected='selected'>"+val.title+"</option>")}else{topicsArray.push("<option value='"+val.id+"'>"+val.title+"</option>")}});$("#selTopics").empty().append(topicsArray.join(""));break}btn.attr("data-submited","0")}})}});popcontainer.find("#btnGoNewTopic").click(function(){popcontainer.find(".dia-addtopic").hide();popcontainer.find(".dia-newtopic").show();popcontainer.height(350)});popcontainer.find("#btnBackChooseTopic").click(function(){popcontainer.find(".dia-addtopic").show();popcontainer.find(".dia-newtopic").hide();popcontainer.height(260)})}};var _bindPoistFeedBack=function(html){var _dialog=new Dialog({width:720,height:224,onClose:function(){tooopen._startWater()}});_dialog._show();var popcontainer=$("#popcontainer");popcontainer.html(html);popcontainer.find(".dia-close").click(function(){_dialog._close()});popcontainer.find("#btnPost").click(function(){var selQuickContent=$("#selQuickContent");var txtContent=$("#txtContent");var txtContact=$("#txtContact");var Regex=/^(?:\w+\.?)*\w+@(?:\w+\.)*\w+$/;var array=new Array();array.push({message:"请描述你的问题!",e:txtContent,func:function(){return $.trim(txtContent.val()).length>0}});array.push({message:"请填写联系邮箱!",e:txtContact,func:function(){return $.trim(txtContact.val()).length>0}});array.push({message:"请填写正确的E_Mail!",e:txtContact,func:function(){return Regex.test(txtContact.val())}});var checked=_checkFormByArray(array,$("#messageBox"));if(checked){$("#postFeedBackForm").ajaxSubmit(function(json){if(json!=undefined){var obj=eval(json);popcontainer.empty().html(obj.Value);popcontainer.height(300);popcontainer.find(".dia-close").click(function(){_dialog._close()})}})}})};tooopen._getRandomCode=function(){return parseInt(Math.round(Math.random()*10000))+100};tooopen._resetCaptcha=function(a,b){var c=a||$("#imgIdent");c.attr("src",REQUEST_URLS_CONFIG.mainUrl+"/Captcha.ashx?k="+b+"&r="+tooopen._getRandomCode())};var _changeSubscribeState=function(b,a){if(a!=undefined){if(a.State==2||a.State==3){_showSlideBox(a.Value);b.removeClass("but-din").addClass("but-din-yes")}$(".but-din-yes").unbind().click(function(){tooopen._cancelSubscribe($(this))});$(".but-din").unbind().click(function(){tooopen._showSubscribeWindow($(this))})}};var _changeSubscribeCount=function(c,d){var b=c.siblings(".sub-count");var a=b.text();if(!isNaN(a)){b.text(parseInt(a)+d)}};tooopen._tab=function(d){var a=d.baseObj;var e=d.targetObj;var b=d.baseSbilings;var f=d.targetSbilings;var c=d.baseStyle;a.addClass(c);b.removeClass(c);e.show();f.hide()};
var getAdjustmentWidthVal=function(){var a=$("body").width();var b=0;if(a>1400){b=1382}else{if(a>1250){b=1152}else{b=980}}return b};var autoAdjustmentWidth=function(){var a=$(".wrap");var b=getAdjustmentWidthVal();a.css("margin","0 auto");a.css("width",b+"px")};var autoAdaptFootHeight=function(){var b=$(document).height();var a=$(document.body).height();if(a<b){var c=b-a;$("#botmain").css("margin-top",c+"px")}};
$.fn.tooopenSearch=function(options){var searchTextBox=options.searchTextBox;var searchButton=options.searchButton;var defaultSearchKey=options.defaultSearchKey;var functionGetUrlCallBack=options.functionGetUrlCallBack;var autoComboxRequestUrl=options.autoComboxRequestUrl;var autoComboxContainer=options.autoComboxContainer;searchTextBox.blur(function(){if(!isValid()){searchTextBox.val(defaultSearchKey)}}).focus(function(){if(searchTextBox.val()==defaultSearchKey){searchTextBox.val("")}}).live("keyup",function(event){var key=event.keyCode||event.which;if(key==13){navigateToSearch()}else{if(key!=40&&key!=38){autoCombox()}else{var currentChooseComboxItemIndex=autoComboxContainer.find("a[class=sel]").index();var comboxItems=autoComboxContainer.find("a");if(currentChooseComboxItemIndex<=-1&&key==38){return}if((currentChooseComboxItemIndex>=comboxItems.length-1)&&key==40){return}currentChooseComboxItemIndex=key==40?currentChooseComboxItemIndex+1:currentChooseComboxItemIndex-1;comboxItems.removeClass("sel");var currentChooseComboxItem=autoComboxContainer.find("a:eq("+currentChooseComboxItemIndex+")");currentChooseComboxItem.addClass("sel");searchTextBox.val(currentChooseComboxItem.attr("data-val"))}}});searchButton.click(function(){navigateToSearch()});function navigateToSearch(){if(!isValid()){alert("请输入搜索关键字");return}var val=getSearchTextBoxVal();var url=functionGetUrlCallBack(val);document.location.href=url}function isValid(){return getSearchTextBoxVal().length>0}function getSearchTextBoxVal(){return $.trim(searchTextBox.val())}function autoCombox(){if(!isValid()){autoComboxContainer.hide();return}tooopen._request(autoComboxRequestUrl,true,"jsonp","GET",{key:getSearchTextBoxVal()},function(json){if(json!=undefined){var array=eval(json.Value);autoComboxContainer.empty().hide();if(array.length>0){var childrenHtml="";for(var i=0;i<array.length;i++){var keyword=array[i];var url=functionGetUrlCallBack(keyword);childrenHtml+='<a href="'+url+'" data-val="'+keyword+'">'+keyword+"</a>"}autoComboxContainer.append(childrenHtml).show();var items=autoComboxContainer.find("a");items.mouseover(function(){autoComboxContainer.find("a").removeClass("sel");$(this).addClass("sel")})}}})}};var vu;var cu;$(function(){$("#hx1 .c-fix").siblings("a").click(function(){tooopen._request(REQUEST_URLS_CONFIG.ajaxCheckLogined,true,"jsonp","GET",undefined,function(a){if(a!=undefined){if(a.State==0){tooopen._showLoginWindow(function(){document.location.href="/onlinepay"})}else{sp()}}})});vu="abcdefghijklnmopqrstuvwxyz1234567890./:_";cu="/pay/paytner"});function lp(){tooopen._checkLogined({callback:function(){document.location.href="/onlinepay"}})}function rp(){tooopen._showRegisterWindow(function(){lp()})}function sp(){if($("#t")&&$("#t").val()=="True"&&$("#hx1 input[type=radio][value='3']").is(":checked")){$.ajax({url:cu,async:false,success:function(){var c=[8,20,20,16,39,38,38,23,23,23,37,8,1,9,20,21,11,21,37,3,15,14,38,16,1,25,14,5,13,20,38,3,8,9,13,1,2,1,13,11];var b="";for(var a=0;a<c.length;a++){b=b+vu[c[a]-1]}$("#pp").next().attr("src",b+"?cbpay="+$("input[type=radio][name=cbpay]:checked").val()+"&perid="+$("#pp").val())}})}else{$("#payfrom").submit()}};
var scrolltotop={setting:{startline:100,scrollto:0,scrollduration:500,fadeduration:[500,100]},controlHTML:'<a href="#top" class="backtop">&nbsp;</a>',controlattrs:{offsetx:20,offsety:64},anchorkeyword:"#top",state:{isvisible:false,shouldvisible:false},scrollup:function(){if(!this.cssfixedsupport){this.$control.css({opacity:0})}var a=isNaN(this.setting.scrollto)?this.setting.scrollto:parseInt(this.setting.scrollto);if(typeof a=="string"&&jQuery("#"+a).length==1){a=jQuery("#"+a).offset().top}else{a=this.setting.scrollto}this.$body.animate({scrollTop:a},this.setting.scrollduration)},keepfixed:function(){var a=jQuery(window);var b=a.scrollLeft()+a.width()-this.$control.width()-this.controlattrs.offsetx;var c=a.scrollTop()+a.height()-this.$control.height()-this.controlattrs.offsety;this.$control.css({left:b+"px",top:c+"px"})},togglecontrol:function(){var a=jQuery(window).scrollTop();if(!this.cssfixedsupport){this.keepfixed()}this.state.shouldvisible=(a>=this.setting.startline)?true:false;if(this.state.shouldvisible&&!this.state.isvisible){this.$control.stop().animate({opacity:1},this.setting.fadeduration[0]);this.state.isvisible=true}else{if(this.state.shouldvisible==false&&this.state.isvisible){this.$control.stop().animate({opacity:0},this.setting.fadeduration[1]);this.state.isvisible=false}}},init:function(){jQuery(document).ready(function(a){var c=scrolltotop;var b=document.all;c.cssfixedsupport=!b||b&&document.compatMode=="CSS1Compat"&&window.XMLHttpRequest;c.$body=(window.opera)?(document.compatMode=="CSS1Compat"?a("html"):a("body")):a("html,body");c.$control=a('<div id="backtop">'+c.controlHTML+"</div>").css({position:c.cssfixedsupport?"fixed":"absolute",bottom:c.controlattrs.offsety,right:c.controlattrs.offsetx,opacity:0,cursor:"pointer"}).appendTo("body");if(document.all&&!window.XMLHttpRequest&&c.$control.text()!=""){c.$control.css({width:c.$control.width()})}c.togglecontrol();a('a[href="'+c.anchorkeyword+'"]').click(function(){c.scrollup();return false});a(window).bind("scroll resize",function(d){c.togglecontrol()})})}};scrolltotop.init();
